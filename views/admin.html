<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/admin.css">
</head>

<body>
    <header class="menu_header">
        <div class="logotipado">
            <img src="../storage/img/logoprincipal.svg" alt="">
            <h1>Rank My Fandom</h1>
        </div>
        <div class="opciones_menu">
            <a href="../views/admin.html">Aprobadas</a>
            <a href="../views/pendientes.html">Pendientes</a>
            <a href="../views/crearcategory.html">Crear</a>
        </div>
        <div class="opcion_notificacion">
            <img src="../storage/img/lupita.svg" alt="">
            <img src="../storage/img/campanita.svg" alt="">
        </div>
    </header>
    <article id="top_tendencia"></article>
</body>
<script>
    async function fetchCategoriasYPeliculas() {
        try {
            // Traemos categorías
            const resCat = await fetch("http://localhost:3000/api/v1/categories");
            const categorias = await resCat.json();

            // Traemos películas
            const resMovies = await fetch("http://localhost:3000/api/v1/movies");
            const movies = await resMovies.json();

            const mainContainer = document.getElementById("top_tendencia");

            categorias.forEach(cat => {
                // Crear <article> por cada categoría
                const article = document.createElement("article");
                article.classList.add("top_tendencia");

                article.innerHTML = `
                <h2>${cat.titulo}</h2>
                <div class="carrusel">
                    <button class="flecha izquierda">&#10094;</button>
                    <div class="categorizacion"></div>
                    <button class="flecha derecha">&#10095;</button>
                </div>
            `;

                const carrusel = article.querySelector(".carrusel");
                const contenedor = article.querySelector(".categorizacion");
                const btnIzquierda = article.querySelector(".flecha.izquierda");
                const btnDerecha = article.querySelector(".flecha.derecha");

                // Filtramos películas SOLO de esta categoría y tipo "Pelicula"
                // y que estén aceptadas
                const peliculasDeCategoria = movies.filter(m =>
                    // m.tipo.toLowerCase() === "pelicula" &&
                    m.categoria === cat.titulo &&
                    m.estado === "aceptada"
                );

                // Insertamos las películas en el carrusel
                peliculasDeCategoria.forEach(movie => {
                    const card = document.createElement("div");
                    card.classList.add("caja_tendencias");
                    card.innerHTML = `
                    <div class="banner-peli">
                        <img src="${movie.img}" alt="${movie.titulo}">
                    </div>
                    <div class="info_peli">
                        <div class="likes_dislikes">
                            <div class="likes">
                                <img src="../storage/img/like.svg">
                                <p>${movie.likes || 0}</p>
                            </div>
                            <div class="dislikes">
                                <img src="../storage/img/dislike.svg">
                                <p>${movie.dislikes || 0}</p>
                            </div>
                        </div>
                        <div class="comentarios">
                            <img src="../storage/img/comentario.png">
                            <p>${movie.comentarios || 0}</p>
                        </div>
                    </div>
                `;
                    contenedor.appendChild(card);
                });

                // Eventos de scroll en el carrusel
                btnDerecha.addEventListener("click", () => {
                    contenedor.scrollBy({ left: 300, behavior: "smooth" });
                });
                btnIzquierda.addEventListener("click", () => {
                    contenedor.scrollBy({ left: -300, behavior: "smooth" });
                });

                // Añadimos el artículo al DOM
                mainContainer.appendChild(article);
            });

        } catch (err) {
            console.error("Error cargando categorías y películas:", err);
        }
    }

    // Ejecutar al cargar la página
    document.addEventListener("DOMContentLoaded", fetchCategoriasYPeliculas);
</script>
</body>

</html>